<% if @virtualhost and @virtualhost.kind_of?(Array) and ! @virtualhost.empty? -%>
<VirtualHost <%= @virtualhost.join(" ") %>>
<% else -%>
<VirtualHost <%= @virtualhost %>>
<% end -%>
<% if @servername and ! @servername.empty? -%>
ServerName <%= @servername %>
<% end -%>
<% if @serveralias and ! @serveralias.empty? -%>
<% if @serveralias.kind_of?(Array) -%>
<% @serveralias.each do |sa| -%>
ServerAlias <%= sa %>
<% end -%>
<% else -%>
ServerAlias <%= @serveralias %>
<% end -%>
<% end -%>
<% if @serveradmin and ! @serveradmin.empty? -%>
ServerAdmin <%= @serveradmin %>
<% end -%>

<% if @tohttps and ! @tohttps.empty?  -%>
RewriteEngine On
RewriteCond %{HTTPS} !=on
RewriteCond %{HTTP:X-Forwarded-Proto} !https [NC]
RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]
<% else -%>

<%= scope.function_template(['httpd/setenv.erb']) -%>

<% if @documentroot and ! @documentroot.empty? -%>
DocumentRoot <%= @documentroot %>

<Directory <%= @documentroot %>>
Options FollowSymlinks
AllowOverride All
</Directory>
<% end -%>

<% if @directoryindex and ! @directoryindex.empty? -%>
DirectoryIndex <%= @directoryindex.join(" ") %>
<% end -%>

<%= scope.function_template(['httpd/alias.erb']) -%>
<%= scope.function_template(['httpd/directory.erb']) -%>
<%= scope.function_template(['httpd/header.erb']) -%>
<%= scope.function_template(['httpd/include.erb']) -%>
<%= scope.function_template(['httpd/proxy.erb']) -%>
<%= scope.function_template(['httpd/rewrite.erb']) -%>

<%= scope.function_template(['httpd/ssl.erb']) -%>

<%= scope.function_template(['httpd/vhost/alias.erb']) -%>
<%= scope.function_template(['httpd/vhost/header.erb']) -%>
<%= scope.function_template(['httpd/vhost/include.erb']) -%>
<%= scope.function_template(['httpd/vhost/proxy.erb']) -%>
<%= scope.function_template(['httpd/vhost/rewrite.erb']) -%>

<%= scope.function_template(['httpd/vhost/ssl.erb']) -%>

<% if @httpd_version == '2.2' -%>
RewriteLog "|/usr/sbin/rotatelogs /var/log/httpd/rewrite_log_<%= @name %>_%Y%m%d 86400"
RewriteLogLevel 1
<% else -%>
LogLevel alert rewrite:trace1
<% end -%>

ErrorLog "|/usr/sbin/rotatelogs /var/log/httpd/error_log_<%= @name %>_%Y%m%d 86400"
CustomLog "|/usr/sbin/rotatelogs /var/log/httpd/access_log_<%= @name %>_%Y%m%d 86400" combined

<% end -%>
</VirtualHost>
